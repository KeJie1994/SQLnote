<html>
<head>
  <title>第六章 命令模式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1452"/>
<h1>第六章 命令模式</h1>

<div>
<span><div>第六章 命令模式</div><div><br/></div><div>1.创建一个类似于智能家居的万能控制器，控制各种家电。我们要将“请求”封装成对象（一个对象通过在特定接受者上绑定一组动作来封装请求），以便使用不同的请求，队列或者日志来参数话其对象---命令模式。</div><div><br/></div><div>2</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//首先完成对命令模式的封装</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public interface Command</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void execute();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//所有具体命令的对象都要实现这个接口，这就做到了封装，比如灯这个对象</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Light</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Light(){}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void on()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;Light is on&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void off()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;Light is off&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//通过上述接口封装“开灯”这个命令，就是所谓的命令对象，他把动作和接受者包进对象之中，只暴露一个execute方法</span></div><div><font face="Monaco">public class LightOnCommand implements Command</font></div><div><font face="Monaco">{</font></div><div><font face="Monaco">    Light light;</font></div><div><font face="Monaco">    public LightOnCommand(Light light)</font></div><div><font face="Monaco">    {</font></div><div><font face="Monaco">        this.light=light;</font></div><div><font face="Monaco">    }</font></div><div><font face="Monaco">    public void excute()</font></div><div><font face="Monaco">    {</font></div><div><font face="Monaco">        light.on();</font></div><div><font face="Monaco">    }</font></div><div><font face="Monaco">}</font></div><div><br/></div><div><font face="Monaco">//我们的遥控器对于上述封装一无所知，才能做到解耦</font></div><div>public calss SimpleRemoteControl</div><div>{</div><div>    Command slot;</div><div>    public SimpleRemoteCOmtrol(){}</div><div>    public void setCommand(Command command)</div><div>    {</div><div>        slot=command;</div><div>    }</div><div>    public void buttonWasPressed()</div><div>    {</div><div>        slot.excute();</div><div>    }</div><div>}</div><div><br/></div><div>//在一个要控制上实现控制多个家电的能力可以用一个数组来维修这样的一组命令。</div><div>public class RemoteControl</div><div>{</div><div>    Command[] onCommands;</div><div>    Command[] offCommands;</div><div>    public RemoteCOntrol</div><div>    {</div><div>        onCommands=new Command[7];</div><div>        offCommands=new Command[7];</div><div>        Command noCommand=new NoCommand();</div><div>        for(int i=0;i&lt;7;i++)</div><div>        {</div><div>            onCommands[i]=noCommand;</div><div>            offCommands[i]=noCommand;</div><div>        }</div><div>    }</div><div>    public void setCommand(int slot,Command onCommand,Command offCommand)</div><div>    {</div><div>        onCommands[slot]=onCommand;</div><div>        offCommands[slot]=offCommand;</div><div>    }</div><div>    public void onButtonWasPushed(int slot)</div><div>    {</div><div>        onCommands[slot].excute();</div><div>    }</div><div>    public void offButtonWasPushed(int slot)</div><div>    {</div><div>        offCommands[slot].excute();</div><div>    }</div><div>}</div><div><br/></div><div>//这里有一个noCommand的对象出现在初始化对象时，这是个小技巧，我们不希望每次在检查摸个插槽是不是绑定了命令，就引入这个命令实现一个不做事情的命令。</div><div>public class NoCommand implements Command()</div><div>{</div><div>    public void excute();</div><div>}</div><div>//每一个插槽默认为noCommand对象，这就是典型的空对象例子。</div></div><div><br/></div><div>3.我们要在命令模式向设置类似undo的撤销命令来撤销发出的命令请求</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public interface Command()</div><div>{</div><div>    public void excute();</div><div>    public void undo();</div><div>}</div><div>//开关点灯</div><div>public class LightOnCommand implements Commnad()</div><div>{</div><div>    Light light;</div><div>    public LightOnCommand(Light light)</div><div>    {</div><div>        this.light=light;</div><div>    }</div><div>    public void excute()</div><div>    {</div><div>        light.on();</div><div>    }</div><div>    public void undo()</div><div>    {</div><div>        light.off();</div><div>    }</div><div>}</div><div>//我们需要让遥控器记住上次到底做了什么操作才能撤销</div><div>    <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class RemoteControlWithUndo</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    Command[] onCommands;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    Command[] offCommands;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    Command undoCommand;</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public RemoteCOntrol</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        onCommands=new Command[7];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        offCommands=new Command[7];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Command noCommand=new NoCommand();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        for(int i=0;i&lt;7;i++)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            onCommands[i]=noCommand;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            offCommands[i]=noCommand;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    undoCommand=noCommand;</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void setCommand(int slot,Command onCommand,Command offCommand)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        onCommands[slot]=onCommand;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        offCommands[slot]=offCommand;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void onButtonWasPushed(int slot)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        onCommands[slot].excute();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    undoCommand=onCommands[slot];</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void offButtonWasPushed(int slot)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        offCommands[slot].excute();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    undoCommand=offCommands[slot];</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span>  public void undoButtonWasPushed()</span><br/></div><div><span><span>  {</span><br/></span></div><div><span><span>     undoCommand.undo();</span><br/></span></div><div><span><span>  }</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div>4.对于电灯只有两个状态，如果对于吊扇有多个转速，高中低关四个状态时</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public class CeilingFan</div><div>{</div><div><span>    String locatin=&quot;&quot;;</span><br/></div><div><span><span>    int level;</span><br/></span></div><div><span><span>    public static final int HIGH=2;</span><br/></span></div><div><span><span>    public static final int MEDIUM=1;</span><br/></span></div><div><span><span>    public static final int LOW=0;</span><br/></span></div><div><span><span>    public CeilingFan(String location)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    this.location=location;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void high()</span><br/></span></div><div><span>    {</span></div><div><span>    </span><span>    level=HIGH;</span></div><div><span><span>    </span><span>    System.out.println(location+&quot;ceilint fan is on high&quot;);</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void medium()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    level=MEDIUM;</span><br/></span></div><div><span><span>    </span><span>    System.out.println(location+&quot;ceiling fan is on medium&quot;);</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void low()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    level=LOW;</span><br/></span></div><div><span><span>    </span><span>    System.out.println(location+&quot;Ceiling fan is on low&quot;);</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void off()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    level=0;</span><br/></span></div><div><span><span>    </span><span>    System.out.println(location+&quot;ceiling fan is off&quot;);</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public int getSpeed()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    return level;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div>}</div><div><br/></div><div>//要实现风扇各个转速命令时，要记录之前的转速</div><div>public class CeilingFanHighCommand implements Command</div><div>{</div><div><span>    CeilingFan ceilingFan;</span><br/></div><div><span>    int prevSpeed;</span><br/></div><div><span><span>    public CeilingFanHighCommnad(CeilingFan ceilingFan)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    this,ceilingFan=ceilingFan;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void execute()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    prevSpeed=ceilingFan.getSpeed();</span><br/></span></div><div><span><span>    </span><span>    ceilingFan.high();</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void undo()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    switch(preSpeed)</span><br/></span></div><div><span><span>    </span><span>    {</span><br/></span></div><div><span>    </span><span>    </span><span>    case CeilingFan.HIGH:</span></div><div><span><span><span>    </span><span>    </span><span>    </span><span>    </span>ceilingFan.high();break;</span><br/></span></div><div><span><span>    </span><span>    </span><span>    case CeilingFan.MEDIUM:</span><br/></span></div><div><span><span>    </span><span>    </span><span>    </span><span>    ceilingFan.medium();break;</span><br/></span></div><div><span><span>    </span><span>    </span><span>    case CeilingFan.LOW:</span><br/></span></div><div><span>    </span><span>    </span><span>    </span><span>    ceilingFan.low();break;</span></div><div><span><span>    </span><span>    </span><span>    default:</span><br/></span></div><div><span><span>    </span><span>    </span><span>    </span><span>    ceilingFan.off();break</span><br/></span></div><div><span><span>    </span><span>    }</span><br/></span></div><div><span><span>    }</span><br/></span></div><div>}</div></div><div><br/></div></span>
</div></body></html> 