<html>
<head>
  <title>第十四章 责任链模式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1510"/>
<h1>第十四章 责任链模式</h1>

<div>
<span><div>第十四章 责任链模式</div><div><br/></div><div>1.定义：使多个对象都有机会处理请求，从而避免了请求的发送者和接受者之间的耦合关系，将这些对象连着一条链，并沿着这条链传递该请求，知道有对象处理它为止。</div><div><br/></div><div><img src="第十四章 责任链模式_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>2.先看一段if...else的代码</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public void test(int i,Request request)</div><div>{</div><div><span>    if(i==1)</span><br/></div><div><span><span>    </span><span>    Handler1.response(request);</span><br/></span></div><div><span><span>    else if(i==2)</span><br/></span></div><div><span><span>    </span><span>    Handler2.response(request);</span><br/></span></div><div><span><span>    else if(i==3)</span><br/></span></div><div><span><span>    </span><span>    Handler3.response(request);</span><br/></span></div><div><span><span>    else if(i==4)</span><br/></span></div><div><span><span>    </span><span>   <span> Handler4.response(request);</span></span><br/></span></div><div><span><span>    else</span><br/></span></div><div><span><span>    </span><span>    Handler5.response(request);</span><br/></span></div><div>}</div></div><div>缺点：</div><div>（1）代码臃肿：判断条件过多时，代码无法看。（因为判断条件可能会需要复杂的计算，也可能要查询数据库等）</div><div>（2）耦合度高，增加处理请求的类时，只能增加else if判定条件，另外这个判定顺序是死的，要想改变判定顺序，只能修改这个条件语句。</div><div><br/></div><div>3.责任链模式</div><div>（1）<span style="box-sizing: border-box; outline: 0px; word-wrap: break-word; font-weight: bold;">抽象处理类：</span><span style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">抽象处理类中主要包含一个指向下一处理类的成员变量nextHandler和一个处理请求的方法handRequest，handRequest方法的主要主要思想是，如果满足处理的条件，则有本处理类来进行处理，否则由nextHandler来处理。</span></div><div><span style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">（2）<span style="box-sizing: border-box; outline: 0px; word-wrap: break-word; font-weight: bold;">具体处理类：</span><span style="box-sizing: border-box; outline: 0px; word-wrap: break-word;">具体处理类主要是对具体的处理逻辑和处理的适用条件进行实现。</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>class Level</div><div>{</div><div><span>    private int level=0;</span><br/></div><div><span><span>    public level(int level)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span>    </span><span>    this.level=level;</span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public boolean above(Level level)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    <span>    if(this.level&gt;=level)</span></span><br/></span></div><div><span><span>    </span><span>    </span><span>    return true;</span><br/></span></div><div><span><span>    </span><span>    else</span><br/></span></div><div><span><span>    </span><span>    </span><span>    return false;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div>}</div><div><br/></div><div>class Request</div><div>{</div><div><span>    Level level;</span><br/></div><div><span><span>    public Request(Level level)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    this.level=level;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public level getLevel()</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    return level;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div>}</div><div><br/></div><div>class Response</div><div>{</div><div>}</div><div><br/></div><div>abstract class Handler</div><div>{</div><div><span>    private Handler nextHandler;</span><br/></div><div><span><span>    public final Response handleRequest(Request request)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    Response response;</span><br/></span></div><div><span><span>    </span><span>    if(this.getHandleLevel().above(request.getLevel())</span><br/></span></div><div><span>    </span><span>    {</span></div><div><span><span>    </span><span>    </span><span>    response=this.response(request);</span><br/></span></div><div><span><span>    </span><span>    }</span><br/></span></div><div><span><span>    </span><span>    else</span><br/></span></div><div><span><span>    </span><span>    {</span><br/></span></div><div><span><span>    </span><span>    </span><span>    if(this.nextHandle!=null)</span><br/></span></div><div><span><span>    </span><span>    </span><span>    </span><span>    this.nextHandler.handleQequest(request);</span><br/></span></div><div><span><span>    </span><span>    </span><span>    else</span><br/></span></div><div><span><span>    </span><span>    </span><span>    </span><span>    System.out.println(&quot;----没有合适的处理器---&quot;);</span><br/></span></div><div><span><span>    </span><span>    }</span><br/></span></div><div><span><span>    </span><span>    return reesponse;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public void setNextHandle(Handler handler)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    this.nextHandler=handler;</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    protected abstract Level getHandleLevel();</span><br/></span></div><div><span><span>    public abstract Response response(Request request);</span><br/></span></div><div>}</div><div><br/></div><div>class ConcreteHandler1 extends Handler</div><div>{</div><div><span>    protected Level getHandleLevel1()</span><br/></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>  <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> return new Level(1);</span></span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><span>    public Response response(Request request)</span><br/></span></div><div><span><span>    {</span><br/></span></div><div><span><span>    </span><span>    System.out.println(&quot;---请求由处理器1进行处理---&quot;);</span><br/></span></div><div><span><span>    }</span><br/></span></div><div><span><br/></span></div><div>}</div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class ConcreteHandler2 extends Handler</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    protected Level getHandleLevel2()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      </span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> return new Level(2);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Response response(Request request)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;---请求由处理器2进行处理---&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class ConcreteHandler3 extends Handler</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    protected Level getHandleLevel3()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      </span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> return new Level(3);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Response response(Request request)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;---请求由处理器3进行处理---&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Client</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    public static void main(String[] args)</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    {</span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    </span><span>    Handler handler1=nenw ConcreteHandler1():</span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    </span><span>    <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Handler handler2=nenw ConcreteHandler2():</span></span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span>Handler handler3=nenw ConcreteHandler3():</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    handle1.setNextHandler(handler2);</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    </span><span>    handle2.setNextHandler(handler3);</span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    </span><span>    Response response=handler1.handleRequest(new Requrest(new Level(4)));</span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span><span>    }</span><br/></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div>优缺点：</div><div><span>    责任链模式与if...else相比，耦合性要低一些，因为他吧条件判定分散到各个处理类中，这些处理类的优先顺序可以随便设置。</span><br/></div><div><span>   缺点是在找到正确的处理类时，所有的判定条件都要执行一遍，性能超差。</span></div></span>
</div></body></html> 